{template header}
<div style="height: 30px; clear: both; display: block;"></div>
<div class="area">
    <div class="order-address-wrap">
        <h3 class="confirm-address">
            <a class="manage-address" href="{U:('m=member&c=address')}" target="_blank">管理收货地址</a>
            <span>确认收货地址</span>
        </h3>
        <ul class="address-list" id="address-list">

        </ul>
        <div class="use-new-address">
            <a class="button" id="add-address">使用新地址</a>
        </div>
    </div>
</div>
<div class="blank"></div>
<div class="area">
    <h3>确认订单信息</h3>
    <table cellspacing="1" cellpadding="0" width="100%" class="order-th-table">
        <tr>
            <th>店铺宝贝</th>
            <th width="125">单价</th>
            <th width="125">数量</th>
            <th width="125">小计</th>
        </tr>
    </table>
    <div class="order-item-wrap">
        <table cellpadding="0" cellspacing="0" width="100%" class="order-item-table">
            <thead>
                <tr>
                    <th colspan="4">店铺: 大师兄专卖店</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <div class="info-img">
                            <img src="http://npjs.liaidi.com/data/attachment/image/photo/2017/07/20170731225033308583.jpg">
                        </div>
                        <div class="info-detail">
                            <div class="item-name">安居客即刻了解快递费尽量多加丽枫酒店了是联动放假了看电视九分裤</div>
                            <div class="item-attr">颜色:红色 品质:优</div>
                        </div>
                    </td>
                    <td width="125" class="cell-price">10.00</td>
                    <td width="125" class="cell-num">
                        <div class="quantity-inner">
                            <span class="btn">-
                            </span><input type="text" class="text" value="1"><span class="btn">+</span>
                        </div>
                    </td>
                    <td width="125" class="cell-simple-price">100.00</td>
                </tr>
            </tbody>
        </table>
        <div class="order-ext-wrap">
            <div class="order-ext">
                <div class="ext-name">给掌柜留言:</div>
                <div class="ext-info"><textarea class="textarea" placeholder="选填:对本次交易的说明"></textarea></div>
            </div>
            <div class="order-ext">
                <div class="ext-name">运送方式:</div>
                <div class="ext-info">货到付款</div>
            </div>
            <div class="order-ext">
                <div class="ext-name" style="padding-top: 3px;">合计:</div>
                <div class="ext-info"><span class="total-fee">100.00</span></div>
            </div>
        </div>

        <div class="submit-order">
            <span class="btn" id="submit-order-btn">提交订单</span>
        </div>
    </div>
</div>

<div style="height: 80px; clear: both; display: block;"></div>
<script type="text/template" id="addressItemTPL">
    <li>
        <a class="edit-address" data-id="{address[id]}">修改本地址</a>
        <input type="radio" class="radio" name="address_id" {address[checked]}>
        <span>{address[province]} {address[city]} {address[county]} {address[street]}  ({address[consignee]} 收) {address[phone]}</span>
    </li>
</script>
<script type="text/javascript">
    var dlg;
    function afterSaveAddress(data) {
        dlg.close();
        loadAddress();
    }
    function loadAddress() {
        $.ajax({
            url:"{U:('m=member&c=address&a=batchget')}",
            dataType:'json',
            success:function (response) {
                if (response.errcode == 0){
                    var li = '';
                    $(response.data).each(function (i, data) {
                        li += $("#addressItemTPL").html().replace(/\{address\[(.*?)\]\}/g, function(s, k){
                            data.checked = data.isdefault == 1 ? ' checked' : '';
                            if(typeof data[k] !== 'undefined'){
                                return data[k];
                            }else  {
                                return '';
                            }
                        });
                    });
                    $("#address-list").html(li);
                    $(".edit-address").off('click').on('click', function (e) {
                        var id = $(this).attr('data-id');
                        dlg = DSXUI.dialog({
                            title:'添加收货地址',
                            iframe:"{U:('m=member&c=address&a=frame')}&id="+id,
                            width:'700px',
                            height:'320px',
                            hideBottom:true
                        });
                    });
                }
            }
        });
    }
    $(function () {
        loadAddress();
        $("#add-address").on('click', function () {
            dlg = DSXUI.dialog({
                title:'添加收货地址',
                iframe:"{U:('m=member&c=address&a=frame')}",
                width:'700px',
                height:'320px',
                hideBottom:true
            });
        });
    });
</script>
{template footer}